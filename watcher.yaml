# How often to poll for new commits
poll_interval_seconds: 30
log_steps: true

notify:
  discord_webhook: ${DISCORD_WEBHOOK}
  email:
    enabled: ${EMAIL_ENABLED}
    smtp_host: ${EMAIL_SMTP_HOST}
    smtp_port: ${EMAIL_SMTP_PORT}
    username: ${EMAIL_USERNAME}
    password: ${EMAIL_PASSWORD}
    from: ${EMAIL_FROM}
    to: ${EMAIL_TO}

projects:
  - name: homelab
    mode: worktree                      # clone | worktree
    repo_url: ${REPO_URL}
    branch: ${BRANCH}
    source_repo_path: ${SOURCE_REPO_PATH}   # your dev repo… never switched
    deploy_path: ${DEPLOY_PATH}             # detached worktree lives here

    # Fallback to use watcher.yaml stacks if not defined in homelab repo
    stacks:
      - dir: authentication
        compose: docker-compose.yml
        # If authentication (or any other stack) doesn’t need env… omit env entirely or keep optional: true
        env:
          backend: vault
          secret_path: kv/homelab/authentication
          data_key: env
          optional: true
          materialize: ".env"

      - dir: core
        compose: docker-compose.yaml

      - dir: monitoring
        compose: docker-compose.yml
        env:
          backend: vault
          secret_path: kv/homelab/monitoring
          data_key: env
          optional: true
          materialize: ".env"
